<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
     xmlns:f="http://java.sun.com/jsf/core"
     xmlns:h="http://java.sun.com/jsf/html"
     xmlns:p="http://primefaces.org/ui"
     xmlns:ui="http://java.sun.com/jsf/facelets">

	<h:head>
     	<title>EMC - Relatórios do Jira</title>
	</h:head>

	<h:body>
    	<ui:composition template="./template.xhtml">
     		<ui:define name="content">
		    	<h:form id="form">
			    	<p:growl id="growl" globalOnly="true" autoUpdate="true" showDetail="true" />
			    	<p:panel id="panel">
				     	<f:facet name="header">
							<h:panelGrid columns="2">
						    	<img src="../imagens/EMC_logo.png"/>
						   		<h:outputText value=" - RELATÓRIOS DO JIRA" />
						  	</h:panelGrid>
						</f:facet>
				     	<fieldset>
							<legend>Pesquisa</legend>
						    <h:panelGrid columns="4">	
						     	<h:outputLabel value="Data Inicial:"/>
						     	<p:calendar locale="pt_BR" value="#{reportBean.dataInicial}" effect="fold" showOn="button"/>
						     	<h:outputLabel value="Data Final:"/>
						     	<p:calendar locale="pt_BR" value="#{reportBean.dataFinal}" effect="fold" showOn="button"/>
						     	<p:outputLabel for="projectOrIssue" value="Tipo da Chave:" />
						        <p:selectOneRadio id="projectOrIssue" value="#{reportBean.projectOrIssueSelection}">
						            <f:selectItem itemLabel="Projeto" itemValue="projectKey" />
						            <f:selectItem itemLabel="Atividade" itemValue="IssueKey" />
						        </p:selectOneRadio>
						     	<h:outputLabel value="Key do Projeto ou Atividade:"/>
						     	<h:inputText id="projectKey" value="#{reportBean.projectOrIssueKey}"/>
						     	<p:selectOneMenu value="#{reportBean.selectedCompany}">  
						    		<f:selectItems value="#{reportBean.companies}" var="em" itemLabel="#{em.valor}" />  
								</p:selectOneMenu>
								<p:spacer width="10" height="10" />
								<br/>
								<p:commandButton value="Pesquisar" actionListener="#{reportBean.searchProjects}" update="results" icon="ui-icon-search"/>
							</h:panelGrid>
						</fieldset>
						<br/>
						<br/>
						<hr/>
						<p:panel header="Projetos" id="results" style="border:0px;" rendered="#{not empty reportBean.projetos}">
							<p:dataTable value="#{reportBean.projetos}" var="pro"
									rendered="#{not empty reportBean.projetos}"
									rowKey="#{pro.key}" resizableColumns="true" reflow="true" rows="3" paginator="true" emptyMessage="Nenhum projeto encontrado">
								<p:column headerText="Projeto" width="10%" style="white-space: pre-line; font-size: small;">
									<h:outputText value="#{pro.project}" 
									escape="false" style="white-space: pre-line; font-size: small;"/>
								</p:column>
								<p:column headerText="Atividades" style="white-space: pre-line; font-size: small;">
									<p:dataTable value="#{pro.issues}" var="issue"
									rendered="#{not empty pro.issues}">
									<p:column headerText="Atividade" style="white-space: pre-line; font-size: small;">
										<h:outputText value="#{issue.summary}" 
										escape="false" style="white-space: pre-line; font-size: small;"/>
									</p:column>
									<p:column headerText="Status" style="white-space: pre-line; font-size: small;">
										<h:outputText value="#{issue.status}" 
										escape="false" style="white-space: pre-line; font-size: small;"/>
									</p:column>
									<p:column headerText="Assigned" style="white-space: pre-line; font-size: small;">
										<h:outputText value="#{issue.assigned}" 
										escape="false" style="white-space: pre-line; font-size: small;"/>
									</p:column>
									<p:column headerText="Tempo Estimado" style="white-space: pre-line; font-size: small;">
										<h:outputText value="#{issue.originalEstimate}" 
										escape="false" style="white-space: pre-line; font-size: small;"/>
									</p:column>
									<p:column headerText="Tempo Gasto" style="white-space: pre-line; font-size: small;">
										<h:outputText value="#{issue.timeSpent}" 
										escape="false" style="white-space: pre-line; font-size: small;">
										</h:outputText>
									</p:column>
									<p:column headerText="Tempo Restante" style="white-space: pre-line; font-size: small;">
										<h:outputText value="#{issue.remainingEstimate}" 
										escape="false" style="white-space: pre-line; font-size: small;">
										</h:outputText>
									</p:column>
									<p:column headerText="Work Ratio" style="white-space: pre-line; font-size: small;">
										<h:outputText value="#{issue.workRatio}" escape="false" style="white-space: pre-line; font-size: small;">
										</h:outputText>
									</p:column>
									<p:column headerText="Criador" style="white-space: pre-line; font-size: small;">
										<h:outputText value="#{issue.creator}" escape="false" style="white-space: pre-line; font-size: small;"/>
									</p:column>	
									</p:dataTable>
								</p:column>
							</p:dataTable>
						</p:panel>
			    	</p:panel>
				</h:form>
			</ui:define>
		</ui:composition>
	</h:body>
</html>