<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
     xmlns:f="http://java.sun.com/jsf/core"
     xmlns:h="http://java.sun.com/jsf/html"
     xmlns:p="http://primefaces.org/ui"
     xmlns:ui="http://java.sun.com/jsf/facelets">

	<h:body>
    	<ui:composition template="./template.xhtml">
     		<ui:define name="content">
		    	<h:form id="form">
			    	<p:growl id="growl" globalOnly="true" autoUpdate="true" showDetail="true" />
			    	<p:panel id="panel">
				     	<f:facet name="header">
							<h:panelGrid columns="2">
						    	<img src="../imagens/EMC_logo.png"/>
						   		<h:outputText value=" - RELATÓRIOS DO JIRA" />
						  	</h:panelGrid>
						</f:facet>
						<p:tabView>
							<p:tab title="Worklogs">
								<fieldset>
									<legend>Worklogs da a Atividade</legend>
								    <h:panelGrid columns="2">	
								     	<h:outputLabel value="Key da Atividade:"/>
								     	<h:inputText id="issueKey" value="#{reportBean.issueKey}" title="Digite a Chave da Atividade."/>
								     	<p:tooltip id="toolTipFocus" for="issueKey" showEvent="focus" hideEvent="blur" />
										<br/>
										<p:commandButton value="Pesquisar" actionListener="#{reportBean.searchIssues}" update="issueResults" icon="ui-icon-search"/>
									</h:panelGrid>
								</fieldset>
								<br/>
								<br/>
								<hr/>
								<p:panel header="Atividade" id="issueResults" style="border:0px;">
									<p:dataTable value="#{reportBean.projetos}" var="singleProject"
											rendered="#{not empty reportBean.projetos}"
											rowKey="#{singleProject.key}" resizableColumns="true" reflow="true" rows="5" paginator="true" emptyMessage="Nenhum Atividade foi encontrado">
									 	<p:column style="width:16px">
								            <p:rowToggler />
								        </p:column>
										<p:column headerText="Projeto" style="white-space: pre-line; font-size: small;">
											<h:outputText value="#{singleProject.project}" 
											escape="false" style="white-space: pre-line; font-size: small;"/>
										</p:column>
										<p:column headerText="Chave" style="white-space: pre-line; font-size: small;">
											<h:outputText value="#{singleProject.key}" 
											escape="false" style="white-space: pre-line; font-size: small;"/>
										</p:column>
										<p:column headerText="Data de Criação" style="white-space: pre-line; font-size: small;">
											<h:outputText value="#{singleProject.dataCreate}" 
													escape="false" style="white-space: pre-line; font-size: small;">
												<f:convertDateTime pattern="dd/MM/yyyy"/>
											</h:outputText>
										</p:column>
										
										<p:rowExpansion>
											<p:dataTable value="#{singleProject.atividades}" rows="5" paginator="true" var="issue" rendered="#{not empty singleProject.atividades}">
												<f:facet name="header">
													<h:outputText value="Atividades do Projeto: #{singleProject.key}"/>
												</f:facet>
												<p:column style="width:16px">
										            <p:rowToggler />
										        </p:column>
												<p:column headerText="Atividade" style="white-space: pre-line; font-size: small;">
													<h:outputText value="#{issue.summary}" 
														escape="false" style="white-space: pre-line; font-size: small;"/>
												</p:column>
												<p:column headerText="Assigned" style="white-space: pre-line; font-size: small;">
													<h:outputText value="#{issue.assigned}" 
													escape="false" style="white-space: pre-line; font-size: small;"/>
												</p:column>
												<p:column headerText="Status" style="white-space: pre-line; font-size: small;">
													<h:outputText value="#{issue.status}" 
													escape="false" style="white-space: pre-line; font-size: small;"/>
												</p:column>
												<p:column headerText="Chave" style="white-space: pre-line; font-size: small;">
													<h:outputText value="#{issue.key}" 
														escape="false" style="white-space: pre-line; font-size: small;"/>
												</p:column>
												<p:column headerText="Tipo" style="white-space: pre-line; font-size: small;">
													<h:outputText value="#{issue.issueType}" 
														escape="false" style="white-space: pre-line; font-size: small;"/>
												</p:column>
												<p:column headerText="Data Criação" style="white-space: pre-line; font-size: small;">
													<h:outputText value="#{issue.created}" 
															escape="false" style="white-space: pre-line; font-size: small;">
														<f:convertDateTime pattern="dd/MM/yyyy"/>
													</h:outputText>
												</p:column>
												<p:column headerText="Resolução" style="white-space: pre-line; font-size: small;">
													<h:outputText value="#{issue.resolution}" 
														escape="false" style="white-space: pre-line; font-size: small;"/>
												</p:column>
												<p:column headerText="Tempo Estimado" style="white-space: pre-line; font-size: small;">
													<h:outputText value="#{issue.originalEstimate}h" 
													escape="false" style="white-space: pre-line; font-size: small;"/>
												</p:column>
												<p:column headerText="Tempo Gasto" style="white-space: pre-line; font-size: small;">
													<h:outputText value="#{issue.timeSpent}h" 
													escape="false" style="white-space: pre-line; font-size: small;">
													</h:outputText>
												</p:column>
												<p:column headerText="Tempo Restante" style="white-space: pre-line; font-size: small;">
													<h:outputText value="#{issue.remainingEstimate}h" 
													escape="false" style="white-space: pre-line; font-size: small;">
													</h:outputText>
												</p:column>
												<p:column headerText="Work Ratio" style="white-space: pre-line; font-size: small;">
													<h:outputText value="#{issue.workRatio}%" escape="false" style="white-space: pre-line; font-size: small;">
													</h:outputText>
												</p:column>
												<p:column headerText="Criador" style="white-space: pre-line; font-size: small;">
													<h:outputText value="#{issue.creator}" escape="false" style="white-space: pre-line; font-size: small;"/>
												</p:column>
												
												<p:rowExpansion>
													<p:dataTable value="#{issue.timesheets}" var="worklog" rows="10" paginator="true" rendered="#{not empty issue.timesheets}">
														<f:facet name="header">
															<h:outputText value="Worklogs da Atividade: #{issue.key}"/>
														</f:facet>
														<p:column headerText="Usuário" style="white-space: pre-line; font-size: small;">
															<h:outputText value="#{worklog.userName}" escape="false" style="white-space: pre-line; font-size: small;"/>
														</p:column>
														<p:column headerText="Tempo Gasto" style="white-space: pre-line; font-size: small;">
															<h:outputText value="#{worklog.formatedTimeSpent}" escape="false" style="white-space: pre-line; font-size: small;"/>
														</p:column>
														<p:column headerText="Data" style="white-space: pre-line; font-size: small;">
															<h:outputText value="#{worklog.date}" escape="false" style="white-space: pre-line; font-size: small;">
																<f:convertDateTime pattern="dd/MM/yyyy"/>
															</h:outputText>
														</p:column>
														<p:column headerText="Comentario" style="white-space: pre-line; font-size: small;">
															<h:outputText value="#{worklog.comment}" escape="false" style="white-space: pre-line; font-size: small;"/>
														</p:column>
													</p:dataTable>
												</p:rowExpansion>
											</p:dataTable>
										</p:rowExpansion>
									</p:dataTable>
								</p:panel>
							</p:tab>
							<p:tab title="Projetos e Atividades">
								<fieldset>
									<legend>Pesquisar os Projetos no JIRA</legend>
								    <h:panelGrid columns="4">	
								     	<h:outputLabel value="Data Inicial:"/>
								     	<p:calendar locale="pt" value="#{reportBean.dataInicial}" effect="fold" showOn="button"/>
								     	<h:outputLabel value="Data Final:"/>
								     	<p:calendar locale="pt" value="#{reportBean.dataFinal}" effect="fold" showOn="button"/>
								     	<h:outputLabel value="Key do Projeto:"/>
								     	<h:inputText id="projectKey" value="#{reportBean.projectKey}"/>
								     	<h:outputLabel value="Cliente:"/>
								     	<p:selectOneMenu value="#{reportBean.selectedCompany}" editable="true">  
								    		<f:selectItems value="#{reportBean.defaultCompanies}" var="em" itemLabel="#{em.valor}" />  
										</p:selectOneMenu>
										<p:commandButton value="Pesquisar" actionListener="#{reportBean.searchProjects}" update="projectResults" icon="ui-icon-search"/>
									</h:panelGrid>
								</fieldset>
								<br/>
								<br/>
								<hr/>
								<p:panel header="Projetos" id="projectResults" style="border:0px;">
									<p:messages id="messages" />
									<p:dataTable value="#{reportBean.projetos}" var="pro"
											rendered="#{not empty reportBean.projetos}"
											rowKey="#{pro.key}" resizableColumns="true" reflow="true" rows="5" paginator="true" emptyMessage="Nenhum projeto encontrado">
									 	<p:column style="width:16px">
								            <p:rowToggler />
								        </p:column>
										<p:column headerText="Projeto" style="white-space: pre-line; font-size: small;">
											<h:outputText value="#{pro.project}" 
											escape="false" style="white-space: pre-line; font-size: small;"/>
										</p:column>
										<p:column headerText="Chave" style="white-space: pre-line; font-size: small;">
											<h:outputText value="#{pro.key}" 
											escape="false" style="white-space: pre-line; font-size: small;"/>
										</p:column>
										<p:column headerText="Data de Criação" style="white-space: pre-line; font-size: small;">
												<h:outputText value="#{pro.dataCreate}" 
														escape="false" style="white-space: pre-line; font-size: small;">
													<f:convertDateTime pattern="dd/MM/yyyy"/>
												</h:outputText>
										</p:column>
										
										<p:rowExpansion>
											<p:dataTable value="#{pro.atividades}" rows="5" paginator="true" var="issue" rendered="#{not empty pro.atividades}">
												<f:facet name="header">
													<h:outputText value="Atividades do Projeto: #{pro.key}"/>
												</f:facet>
												<p:column style="width:16px">
										            <p:rowToggler />
										        </p:column>
												<p:column headerText="Atividade" style="white-space: pre-line; font-size: small;">
													<h:outputText value="#{issue.summary}" 
														escape="false" style="white-space: pre-line; font-size: small;"/>
												</p:column>
												<p:column headerText="Assigned" style="white-space: pre-line; font-size: small;">
													<h:outputText value="#{issue.assigned}" 
													escape="false" style="white-space: pre-line; font-size: small;"/>
												</p:column>
												<p:column headerText="Status" style="white-space: pre-line; font-size: small;">
													<h:outputText value="#{issue.status}" 
													escape="false" style="white-space: pre-line; font-size: small;"/>
												</p:column>
												<p:column headerText="Chave" style="white-space: pre-line; font-size: small;">
													<h:outputText value="#{issue.key}" 
														escape="false" style="white-space: pre-line; font-size: small;"/>
												</p:column>
												<p:column headerText="Tipo" style="white-space: pre-line; font-size: small;">
													<h:outputText value="#{issue.issueType}" 
														escape="false" style="white-space: pre-line; font-size: small;"/>
												</p:column>
												<p:column headerText="Data Criação" style="white-space: pre-line; font-size: small;">
													<h:outputText value="#{issue.created}" 
																escape="false" style="white-space: pre-line; font-size: small;">
														<f:convertDateTime pattern="dd/MM/yyyy"/>
													</h:outputText>
												</p:column>
												<p:column headerText="Resolução" style="white-space: pre-line; font-size: small;">
													<h:outputText value="#{issue.resolution}" 
														escape="false" style="white-space: pre-line; font-size: small;"/>
												</p:column>
												<p:column headerText="Tempo Estimado" style="white-space: pre-line; font-size: small;">
													<h:outputText value="#{issue.originalEstimate}h" 
													escape="false" style="white-space: pre-line; font-size: small;"/>
												</p:column>
												<p:column headerText="Tempo Gasto" style="white-space: pre-line; font-size: small;">
													<h:outputText value="#{issue.timeSpent}h" 
													escape="false" style="white-space: pre-line; font-size: small;">
													</h:outputText>
												</p:column>
												<p:column headerText="Tempo Restante" style="white-space: pre-line; font-size: small;">
													<h:outputText value="#{issue.remainingEstimate}h" 
													escape="false" style="white-space: pre-line; font-size: small;">
													</h:outputText>
												</p:column>
												<p:column headerText="Work Ratio" style="white-space: pre-line; font-size: small;">
													<h:outputText value="#{issue.workRatio}%" escape="false" style="white-space: pre-line; font-size: small;">
													</h:outputText>
												</p:column>
												<p:column headerText="Criador" style="white-space: pre-line; font-size: small;">
													<h:outputText value="#{issue.creator}" escape="false" style="white-space: pre-line; font-size: small;"/>
												</p:column>
												
												<p:rowExpansion>
													<p:dataTable value="#{issue.timesheets}" var="worklog" rows="10" paginator="true" rendered="#{not empty issue.timesheets}">
														<f:facet name="header">
															<h:outputText value="Worklogs da Atividade: #{issue.key}"/>
														</f:facet>
														<p:column headerText="Usuário" style="white-space: pre-line; font-size: small;">
															<h:outputText value="#{worklog.userName}" escape="false" style="white-space: pre-line; font-size: small;"/>
														</p:column>
														<p:column headerText="Tempo Gasto" style="white-space: pre-line; font-size: small;">
															<h:outputText value="#{worklog.formatedTimeSpent}" escape="false" style="white-space: pre-line; font-size: small;"/>
														</p:column>
														<p:column headerText="Data" style="white-space: pre-line; font-size: small;">
															<h:outputText value="#{worklog.date}" escape="false" style="white-space: pre-line; font-size: small;">
																<f:convertDateTime pattern="dd/MM/yyyy"/>
															</h:outputText>
														</p:column>
														<p:column headerText="Comentario" style="white-space: pre-line; font-size: small;">
															<h:outputText value="#{worklog.comment}" escape="false" style="white-space: pre-line; font-size: small;"/>
														</p:column>
													</p:dataTable>
												</p:rowExpansion>
											</p:dataTable>
										</p:rowExpansion>
									</p:dataTable>
								</p:panel>
							</p:tab>
						</p:tabView>
			    	</p:panel>
				</h:form>
			</ui:define>
		</ui:composition>
	</h:body>
</html>